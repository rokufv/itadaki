<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>頂（Itadaki）- 富士山登頂準備</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Emergency Contact Bar -->
    <div class="emergency-bar" id="emergencyBar">
        <button class="emergency-btn" id="emergencyBtn">
            <span class="emergency-icon">🆘</span>
            <span class="emergency-text">緊急連絡</span>
        </button>
        <div class="connection-status" id="connectionStatus">
            <span class="status-dot online"></span>
            <span class="status-text">オンライン</span>
        </div>
    </div>

    <!-- Emergency Contact Modal -->
    <div class="modal-overlay" id="emergencyModal">
        <div class="emergency-dialog">
            <div class="emergency-dialog-header">
                <h3>🆘 緊急連絡先</h3>
                <button class="menu-close" id="emergencyCloseBtn">✕</button>
            </div>
            <div class="emergency-contacts">
                <a href="tel:119" class="emergency-contact-item urgent">
                    <span class="contact-icon">🚑</span>
                    <div class="contact-info">
                        <div class="contact-title">救急</div>
                        <div class="contact-number">119</div>
                    </div>
                    <span class="call-arrow">📞</span>
                </a>
                <a href="tel:110" class="emergency-contact-item urgent">
                    <span class="contact-icon">🚔</span>
                    <div class="contact-info">
                        <div class="contact-title">山岳遭難救助</div>
                        <div class="contact-number">110</div>
                    </div>
                    <span class="call-arrow">📞</span>
                </a>
                <a href="tel:0555-72-1355" class="emergency-contact-item">
                    <span class="contact-icon">🏥</span>
                    <div class="contact-info">
                        <div class="contact-title">富士山救護所</div>
                        <div class="contact-number">0555-72-1355</div>
                    </div>
                    <span class="call-arrow">📞</span>
                </a>
                <a href="tel:0555-22-0110" class="emergency-contact-item">
                    <span class="contact-icon">👮</span>
                    <div class="contact-info">
                        <div class="contact-title">富士吉田警察署</div>
                        <div class="contact-number">0555-22-0110</div>
                    </div>
                    <span class="call-arrow">📞</span>
                </a>
            </div>
            <div class="emergency-note">
                <p>⚠️ 緊急時は迷わず連絡してください</p>
                <p>📍 現在地を正確に伝えましょう</p>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div class="logo">🗻 頂（Itadaki）</div>
            <div>富士山登頂準備・チーム管理システム</div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav" id="bottomNav">
            <button class="nav-item active" data-tab="dashboard">
                <span class="nav-icon">📊</span>
                <span class="nav-label">ホーム</span>
            </button>
            <button class="nav-item" data-tab="safety">
                <span class="nav-icon">🏥</span>
                <span class="nav-label">安全</span>
            </button>
            <button class="nav-item" data-tab="gear">
                <span class="nav-icon">🎒</span>
                <span class="nav-label">装備</span>
            </button>
            <button class="nav-item" data-tab="menu" id="menuBtn">
                <span class="nav-icon">☰</span>
                <span class="nav-label">メニュー</span>
            </button>
        </nav>

        <!-- Menu Overlay -->
        <div class="menu-overlay" id="menuOverlay">
            <div class="menu-content">
                <div class="menu-header">
                    <h3>メニュー</h3>
                    <button class="menu-close" id="menuCloseBtn">✕</button>
                </div>
                <div class="menu-items">
                    <button class="menu-item" data-tab="members">
                        <span class="menu-item-icon">👥</span>
                        <span class="menu-item-text">メンバー管理</span>
                    </button>
                    <button class="menu-item" data-tab="experience">
                        <span class="menu-item-icon">⛰️</span>
                        <span class="menu-item-text">登山記録</span>
                    </button>
                    <button class="menu-item" data-tab="plan">
                        <span class="menu-item-icon">🗓️</span>
                        <span class="menu-item-text">登頂計画</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="content">
            <div id="dashboard" class="tab-content active">
                <h2>📊 チーム状況</h2>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <div id="teamNameDisplay" style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">チーム名</div>
                            <div id="teamNameText" style="font-size: 1.5em; font-weight: bold; color: #764ba2;">富士山登頂チーム</div>
                        </div>
                        <button class="btn" id="editTeamNameBtn">✏️ 編集</button>
                    </div>
                    <div id="teamNameEdit" style="display: none; margin-top: 15px;">
                        <input type="text" id="teamNameInput" style="width: 100%; padding: 10px; border: 2px solid #764ba2; border-radius: 8px; font-size: 16px; margin-bottom: 10px;">
                        <div>
                            <button class="btn" id="saveTeamNameBtn">保存</button>
                            <button class="btn btn-secondary" id="cancelTeamNameBtn">キャンセル</button>
                        </div>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="memberCount">0名</div>
                    <div>登録メンバー数</div>
                </div>
                <h3 style="margin-top: 20px;">📋 準備度詳細</h3>
                <div id="memberPreparationList" style="margin-bottom: 20px;"></div>
            </div>

            <div id="members" class="tab-content">
                <h2>👥 メンバー登録</h2>
                <div id="memberForm">
                    <div class="form-group">
                        <label>氏名 *</label>
                        <input type="text" id="memberName" placeholder="山田太郎">
                    </div>
                    <div class="form-group">
                        <label>年齢</label>
                        <input type="number" id="memberAge" min="1" max="100" placeholder="30">
                    </div>
                    <div class="form-group">
                        <label>登山経験</label>
                        <select id="memberExperience">
                            <option value="初心者">初心者</option>
                            <option value="中級者">中級者</option>
                            <option value="上級者">上級者</option>
                        </select>
                    </div>
                    <button type="button" class="btn" id="addMemberBtn">➕ メンバー追加</button>
                </div>
                <h3 style="margin-top: 30px;">📋 メンバー一覧</h3>
                <div id="memberList"></div>
            </div>

            <div id="safety" class="tab-content">
                <h2>🏥 安全管理</h2>
                <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="margin-top: 0;">📝 本日の体調記録</h3>
                    <div id="healthForm">
                        <div class="form-group">
                            <label>メンバー選択</label>
                            <select id="healthMember"><option value="">メンバーを選択してください</option></select>
                        </div>
                        
                        <!-- Slider UI for Health Condition -->
                        <div class="slider-group">
                            <label>体調</label>
                            <div class="slider-value-display" id="conditionDisplay">😐 普通 (3)</div>
                            <input type="range" id="healthCondition" class="health-slider" min="1" max="5" value="3" step="1">
                            <div class="slider-labels">
                                <span>😞 不調</span>
                                <span>😐 普通</span>
                                <span>😊 良好</span>
                            </div>
                        </div>

                        <!-- Slider UI for Sleep Hours -->
                        <div class="slider-group">
                            <label>睡眠時間</label>
                            <div class="slider-value-display" id="sleepDisplay">7.0 時間</div>
                            <input type="range" id="sleepHours" class="health-slider" min="0" max="12" value="7" step="0.5">
                            <div class="slider-labels">
                                <span>0h</span>
                                <span>6h</span>
                                <span>12h</span>
                            </div>
                        </div>

                        <!-- Slider UI for Fatigue Level -->
                        <div class="slider-group">
                            <label>疲労度</label>
                            <div class="slider-value-display" id="fatigueDisplay">😌 疲れていない (1)</div>
                            <input type="range" id="fatigueLevel" class="health-slider" min="1" max="5" value="1" step="1">
                            <div class="slider-labels">
                                <span>😌 なし</span>
                                <span>😐 普通</span>
                                <span>😫 高い</span>
                            </div>
                        </div>

                        <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                            <button type="button" class="btn btn-large" id="recordHealthBtn">💾 体調記録を保存</button>
                            <button type="button" class="btn btn-info" id="showHealthHistoryBtn">📊 履歴表示</button>
                            <button type="button" class="btn btn-secondary" id="clearHealthFormBtn">🔄 クリア</button>
                        </div>
                    </div>
                </div>
                <div style="background: #f8d7da; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="margin-top: 0;">⚠️ 高山病リスク評価</h3>
                    <div id="riskAssessment"></div>
                </div>
                <div style="background: #d1ecf1; padding: 20px; border-radius: 10px;">
                    <h3 style="margin-top: 0;">🆘 緊急時の連絡先</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 10px;">
                        <div>📞 救急: 119</div>
                        <div>🏥 富士山救護所: 0555-72-1355</div>
                        <div>🚔 富士吉田警察署: 0555-22-0110</div>
                        <div>⛰️ 山岳遭難救助: 110</div>
                    </div>
                </div>
            </div>

            <div id="gear" class="tab-content">
                <h2>🎒 装備度チェック</h2>
                <div style="background: #e7f3ff; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="margin-top: 0;">🎒 装備チェックリスト</h3>
                    <div class="form-group">
                        <label>メンバー選択</label>
                        <select id="gearMember"><option value="">メンバーを選択してください</option></select>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <button class="btn" data-gear-category="essential">🔴 必須装備</button>
                        <button class="btn btn-warning" data-gear-category="recommended">🟡 推奨装備</button>
                        <button class="btn btn-info" data-gear-category="seasonal">🔵 季節装備</button>
                        <button class="btn btn-danger" id="clearAllGearBtn" style="float: right;">❌ 全解除</button>
                    </div>
                    <div id="gearChecklist"></div>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-success" id="showMemberGearSummaryBtn" style="margin-right: 10px;">📊 全メンバーの装備状況</button>
                        <button class="btn btn-info" id="exportGearChecklistBtn">📤 装備リスト出力</button>
                    </div>
                    <div id="gearSummaryArea" style="margin-top: 20px;"></div>
                </div>
            </div>

            

            <div id="experience" class="tab-content">
                <h2>⛰️ 登山記録</h2>
                <div style="background: #d4edda; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="margin-top: 0;">🏔️ 山名登録</h3>
                    
                    <!-- Popular Mountains Preset -->
                    <div class="mountain-preset-section">
                        <label style="display: block; margin-bottom: 10px; font-weight: 600;">人気の山から選択</label>
                        <div class="mountain-preset-grid">
                            <button class="mountain-preset-btn" data-mountain="富士山" data-elevation="3776" data-distance="20">🗻 富士山</button>
                            <button class="mountain-preset-btn" data-mountain="高尾山" data-elevation="599" data-distance="6.5">🌲 高尾山</button>
                            <button class="mountain-preset-btn" data-mountain="筑波山" data-elevation="877" data-distance="8">⛰️ 筑波山</button>
                            <button class="mountain-preset-btn" data-mountain="北岳" data-elevation="3193" data-distance="18">🏔️ 北岳</button>
                            <button class="mountain-preset-btn" data-mountain="槍ヶ岳" data-elevation="3180" data-distance="22">⛰️ 槍ヶ岳</button>
                            <button class="mountain-preset-btn" data-mountain="穂高岳" data-elevation="3190" data-distance="20">🏔️ 穂高岳</button>
                            <button class="mountain-preset-btn" data-mountain="立山" data-elevation="3015" data-distance="15">⛰️ 立山</button>
                            <button class="mountain-preset-btn" data-mountain="八ヶ岳" data-elevation="2899" data-distance="16">🏔️ 八ヶ岳</button>
                        </div>
                    </div>

                    <div style="text-align: center; margin: 20px 0; color: #666; font-size: 0.9em;">
                        または手動で入力
                    </div>

                    <!-- Manual Input Form -->
                    <div class="mountain-input-form">
                        <div class="form-group">
                            <label>山名</label>
                            <input type="text" id="newMountainName" placeholder="例: 高尾山">
                        </div>
                        <div class="form-row-2">
                            <div class="form-group">
                                <label>標高（m）</label>
                                <input type="number" id="newMountainElevation" min="0" max="4000" placeholder="599">
                            </div>
                            <div class="form-group">
                                <label>距離（km）</label>
                                <input type="number" id="newMountainDistance" step="0.1" min="0" max="50" placeholder="6.5">
                            </div>
                        </div>
                        <button class="btn btn-large btn-success" id="addMountainBtn">🏔️ 山を登録</button>
                    </div>

                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-info" id="showMountainListBtn">📋 登録済み山一覧</button>
                        <button class="btn btn-danger" id="clearAllMountainsBtn">🗑️ 全山削除</button>
                    </div>
                    <div id="mountainListArea" style="margin-top: 20px;"></div>
                </div>
                
                <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="margin-top: 0;">📝 新しい登山記録を追加</h3>
                    <div class="form-group">
                        <label>メンバー選択</label>
                        <select id="hikingMember"><option value="">メンバーを選択してください</option></select>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>山名</label>
                            <select id="mountainSelect"><option value="">登録済みの山から選択</option></select>
                            <input type="text" id="mountainName" placeholder="または直接入力" style="margin-top: 5px;">
                        </div>
                        <div class="form-group"><label>標高差（m）</label><input type="number" id="elevationGain" min="0" max="4000" placeholder="500"></div>
                        <div class="form-group"><label>距離（km）</label><input type="number" id="hikingDistance" step="0.1" min="0" max="50" placeholder="6.5"></div>
                        <div class="form-group">
                            <label>難易度</label>
                            <select id="hikingDifficulty">
                                <option value="初級">初級（ハイキング）</option>
                                <option value="中級">中級（本格登山）</option>
                                <option value="上級">上級（難易度高）</option>
                            </select>
                        </div>
                        <div class="form-group"><label>登山日</label><input type="date" id="hikingDate"></div>
                        <div class="form-group">
                            <label>天候</label>
                            <select id="weather">
                                <option value="晴れ">晴れ</option><option value="曇り">曇り</option><option value="雨">雨</option><option value="雪">雪</option><option value="霧">霧</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>メモ・感想</label>
                        <textarea id="hikingNotes" rows="3" placeholder="登山の感想や注意点など..."></textarea>
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn" id="recordHikingBtn">💾 登山記録を保存</button>
                        <button class="btn btn-secondary" id="clearHikingFormBtn">🔄 フォームクリア</button>
                        <button class="btn btn-info" id="showAllHikingRecordsBtn">📊 全記録表示</button>
                        <button class="btn btn-danger" id="clearHikingRecordsBtn">🗑️ 全記録削除</button>
                    </div>
                </div>

                <div style="background: #e7f3ff; padding: 20px; border-radius: 10px;">
                    <h3 style="margin-top: 0;">📋 登山記録一覧</h3>
                    <div id="hikingHistory"></div>
                </div>
            </div>

            <div id="plan" class="tab-content">
                <h2>🗓️ 登頂計画</h2>
                <div style="background: #eef6ff; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label>富士山登頂予定日</label>
                        <input type="date" id="planDate">
                    </div>
                    <div class="form-group">
                        <label>山小屋</label>
                        <input type="text" id="planHut" placeholder="例: ○○山荘">
                    </div>
                    <div class="form-group" style="display: grid; grid-template-columns: 140px 1fr auto; gap: 10px; align-items: end;">
                        <div>
                            <label>時刻</label>
                            <input type="time" id="planTime" step="900">
                        </div>
                        <div>
                            <label>アクティビティ</label>
                            <input type="text" id="planActivity" placeholder="集合、登山開始、ご来光 など">
                        </div>
                        <div>
                            <button class="btn" id="addPlanEntryBtn">➕ 追加</button>
                        </div>
                    </div>
                    <div style="margin-top: 10px;">
                        <button class="btn btn-secondary" id="clearPlanBtn">🔄 クリア</button>
                        <button class="btn btn-info" id="exportPlanBtn">📤 計画を出力</button>
                    </div>
                </div>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <h3 style="margin-top: 0;">🕒 スケジュール</h3>
                    <div id="planScheduleList"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <div id="confirmModal" class="modal-overlay">
        <div class="confirm-dialog">
            <div id="confirmMessage" style="margin-bottom: 25px; line-height: 1.5;"></div>
            <div>
                <button class="btn btn-secondary" id="confirmCancelBtn">キャンセル</button>
                <button class="btn btn-danger" id="confirmDeleteBtn">削除する</button>
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>